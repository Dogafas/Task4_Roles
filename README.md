# Task4_Roles: Инфраструктура и развертывание Clickhouse стека

Этот проект предназначен для автоматического развертывания инфраструктуры в Yandex Cloud и настройки стека мониторинга и аналитики, состоящего из Clickhouse, Vector и Lighthouse.

## Описание

Проект использует подход Infrastructure as Code (IaC) и Configuration Management:
*   **Terraform**: Создает виртуальные машины в Yandex Cloud, генерирует инвентарь для Ansible и инициирует процесс настройки.
*   **Ansible**: Устанавливает и конфигурирует необходимые сервисы на созданных хостах.

## Компоненты

В рамках проекта разворачиваются следующие сервисы:
*   **Clickhouse** (v22.3.3.44) — колоночная СУБД для аналитики.
*   **Vector** (v1.0.2) — агент для сбора и обработки логов.
*   **Lighthouse** (v1.0.1) — веб-интерфейс для управления Clickhouse.

## Структура проекта

*   `terraform/` — конфигурация инфраструктуры. Содержит манифесты для создания ВМ и автоматического запуска Ansible.
*   `playbook/` — Ansible роли и плейбуки для настройки ПО.

## Требования

*   Terraform >= 0.13
*   Ansible >= 2.10
*   Аккаунт в Yandex Cloud (Service Account с правами `editor`)
*   SSH-ключи (по умолчанию `~/.ssh/id_ed25519`)

## Быстрый старт

### 1. Настройка окружения

Перейдите в директорию Terraform и настройте переменные:

```bash
cd terraform
cp terraform.tfvars.example terraform.tfvars
```

Отредактируйте `terraform.tfvars`, указав `cloud_id`, `folder_id` и путь к ключу сервисного аккаунта.

### 2. Запуск

Выполните развертывание:

```bash
terraform init
terraform apply
```

После подтверждения (`yes`), Terraform автоматически:
1.  Создаст виртуальные машины.
2.  Сгенерирует файл инвентаря.
3.  Запустит Ansible playbook для установки ролей Clickhouse, Vector и Lighthouse.

### 3. Результат

После успешного выполнения вы получите IP-адреса созданных инстансов:

```bash
terraform output vm_ips
```

Подробную информацию о настройке отдельных компонентов см. в terraform/README.md и playbook/README.md.
